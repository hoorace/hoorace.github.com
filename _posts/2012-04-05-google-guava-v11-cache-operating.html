---
comments: true
date: 2012-04-05 01:46:03
layout: post
slug: google-guava-v11-%e4%b8%ad%e7%9a%84cache%e6%93%8d%e4%bd%9c
title: Google Guava V11 中的Cache操作
wordpress_id: 753
categories:
- Java
tag:
- cache
- callable
- guava
- Java
---

<p style="background-color: rgb(230, 230, 250); height: 25px; width: 100%; padding-top: 9px; font-family: arial,helvetica,sans-serif; font-size: 14px; color: rgb(0, 0, 0);"><span style="font-size:14px;"><strong>Google Guava cache的主要功能点： </strong></span></p>
<div style="border-left: 2px solid rgb(204, 204, 204); padding-left: 6px; margin-left: 6px; margin-bottom: 10px;">
	<p>&nbsp;&nbsp;&nbsp; * 你需要给现有系统加速；<br />
		&nbsp;&nbsp;&nbsp; * 有些key需要不知一次的查询获取；<br />
		&nbsp;&nbsp;&nbsp; * 从策略上讲，你的应用需要从策略上把所有的value从cache中清理出来 -- 你试图减少重复的工作；[注：weakKey , weakValue]<br />
		&nbsp;&nbsp;&nbsp; * cache仅仅存储在内存中，没有在文件中或者其他的server上面，如果不满足你的需求，可以考虑Memcached</p>
</div>
<p style="background-color: rgb(230, 230, 250); height: 25px; width: 100%; padding-top: 9px; font-family: arial,helvetica,sans-serif; font-size: 14px; color: rgb(0, 0, 0);"><span style="font-size:14px;"><strong>API的两种调用方式 </strong></span></p>
<div style="border-left: 2px solid rgb(204, 204, 204); padding-left: 6px; margin-left: 6px; margin-bottom: 10px;">
	<p>1：普通的调用方式，通过key得到value的时间较短</p>
	<div style="border-top: 1px solid rgb(148, 218, 58); border-bottom: 1px solid rgb(148, 218, 58); padding: 9px 0pt 9px 16px; background-color: rgb(224, 255, 182);">
		<div>
			<div align="left"><span style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Tahoma; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium;"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;/**</span></font></span></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 不需要延迟处理(泛型的方式封装)</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@return</b></span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>public</b></span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>static</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">&lt;K , V&gt; LoadingCache&lt;K , V&gt; cached(CacheLoader&lt;K , V&gt; cacheLoader) {</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoadingCache&lt;K , V&gt; cache = CacheBuilder.</span><span style="font-size: 10pt;"><i>newBuilder</i></span><span style="font-size: 10pt;">()</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.maximumSize(10000)</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.weakKeys()</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.softValues()</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.refreshAfterWrite(120, TimeUnit.</span></font><font color="#0000C0" face="Courier New" size="2"><span style="font-size: 10pt;"><i>SECONDS</i></span></font><font face="Courier New" size="2"><span style="font-size: 10pt;">)</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.expireAfterWrite(10, TimeUnit.</span></font><font color="#0000C0" face="Courier New" size="2"><span style="font-size: 10pt;"><i>MINUTES</i></span></font><font face="Courier New" size="2"><span style="font-size: 10pt;">)</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#3F7F5F" face="Courier New" size="2"><span style="font-size: 10pt;">// .removalListener(RemovalListeners.asynchronous(listener,executor))</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#3F7F5F" face="Courier New" size="2"><span style="font-size: 10pt;">// .removalListener(MY_LISTENER)</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build(cacheLoader);</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>return</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">cache;</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">/**</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 通过key获取value</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 调用方式 commonCache.get(key) ; return String</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@param</b></span></font><span>&nbsp;</span><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">key</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@return</b></span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@throws</b></span></font><span>&nbsp;</span><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">Exception</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>public</b></span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>static</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">LoadingCache&lt;String , String&gt; commonCache(</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>final</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">String key)</span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>throws</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">Exception{</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>return</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;"><i>cached</i></span><span style="font-size: 10pt;">(</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>new</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">CacheLoader&lt;String , String&gt;(){</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#646464" face="Courier New" size="2"><span style="font-size: 10pt;">@Override</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>public</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">String load(String key)</span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>throws</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">Exception {</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>return</b></span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>null</b></span></font><font face="Courier New" size="2"><span style="font-size: 10pt;">;</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></font></div>
		</div>
	</div>
	<br />
	<p>2：延迟加载的处理方式，通过key得到value的时间较长</p>
	<div style="border-top: 1px solid rgb(148, 218, 58); border-bottom: 1px solid rgb(148, 218, 58); padding: 9px 0pt 9px 16px; background-color: rgb(224, 255, 182);">
		<div>
			<div align="left"><span style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Tahoma; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium;"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">/**</span></font></span></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 对需要延迟处理的可以采用这个机制；(泛型的方式封装)</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@param</b></span></font><span>&nbsp;</span><font color="#7F7F9F" face="Courier New" size="2"><span style="font-size: 10pt;">&lt;K&gt;</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@param</b></span></font><span>&nbsp;</span><font color="#7F7F9F" face="Courier New" size="2"><span style="font-size: 10pt;">&lt;V&gt;</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@param</b></span></font><span>&nbsp;</span><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">key</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@param</b></span></font><span>&nbsp;</span><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">callable</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@return</b></span></font><span>&nbsp;</span><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">V</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@throws</b></span></font><span>&nbsp;</span><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">Exception</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>public</b></span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>static</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">&lt;K,V&gt; Cache&lt;K , V&gt; callableCached(Callable&lt;V&gt; callable)</span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>throws</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">Exception {</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&lt;K, V&gt; cache = CacheBuilder.</span><span style="font-size: 10pt;"><i>newBuilder</i></span><span style="font-size: 10pt;">()</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.maximumSize(10000)</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.expireAfterWrite(10, TimeUnit.</span></font><font color="#0000C0" face="Courier New" size="2"><span style="font-size: 10pt;"><i>MINUTES</i></span></font><font face="Courier New" size="2"><span style="font-size: 10pt;">)</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#3F7F5F" face="Courier New" size="2"><span style="font-size: 10pt;">// .removalListener(RemovalListeners.asynchronous(listener,executor))</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#3F7F5F" face="Courier New" size="2"><span style="font-size: 10pt;">// .removalListener(MY_LISTENER)</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#3F7F5F" face="Courier New" size="2"><span style="font-size: 10pt;">// .weakKeys()</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#3F7F5F" face="Courier New" size="2"><span style="font-size: 10pt;">// .weakValues()</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>return</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">cache;</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">/**</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 通过</span><span style="font-size: 10pt;"><u>callable</u></span><span style="font-size: 10pt;">的方式获取value；</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 调用方式 callableCache.get(key) ; return String</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@param</b></span></font><span>&nbsp;</span><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">key</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@return</b></span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</span></font><span>&nbsp;</span><font color="#7F9FBF" face="Courier New" size="2"><span style="font-size: 10pt;"><b>@throws</b></span></font><span>&nbsp;</span><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">Exception</span></font></div>
			<div align="left"><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>public</b></span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>static</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">Cache&lt;String , String&gt; callableCache(</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>final</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">String key)</span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>throws</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">Exception{</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>return</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;"><i>callableCached</i></span><span style="font-size: 10pt;">(</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>new</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">Callable&lt;String&gt;(){</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#646464" face="Courier New" size="2"><span style="font-size: 10pt;">@Override</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>public</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">String call()</span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>throws</b></span></font><span>&nbsp;</span><font face="Courier New" size="2"><span style="font-size: 10pt;">Exception {</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>return</b></span></font><span>&nbsp;</span><font color="#7F0055" face="Courier New" size="2"><span style="font-size: 10pt;"><b>null</b></span></font><font face="Courier New" size="2"><span style="font-size: 10pt;">;</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</span></font></div>
			<div align="left"><font face="Courier New" size="2"><span style="font-size: 10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></font></div>
		</div>
	</div>
</div>
<p style="background-color: rgb(230, 230, 250); height: 25px; width: 100%; padding-top: 9px; font-family: arial,helvetica,sans-serif; font-size: 14px; color: rgb(0, 0, 0);"><span style="font-size:14px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp; 回收的参数设置 </strong></span></p>
<div style="border-left: 2px solid rgb(204, 204, 204); padding-left: 6px; margin-left: 6px; margin-bottom: 10px;">
	<p>&nbsp;&nbsp;&nbsp; 1. 大小的设置：CacheBuilder.maximumSize(long)&nbsp; CacheBuilder.weigher(Weigher)&nbsp; CacheBuilder.maxumumWeigher(long)<br />
		&nbsp;&nbsp;&nbsp; 2. 时间：expireAfterAccess(long, TimeUnit) expireAfterWrite(long, TimeUnit)<br />
		&nbsp;&nbsp;&nbsp; 3. 引用：CacheBuilder.weakKeys() CacheBuilder.weakValues()&nbsp; CacheBuilder.softValues()<br />
		&nbsp;&nbsp;&nbsp; 4. 明确的删除：invalidate(key)&nbsp; invalidateAll(keys)&nbsp; invalidateAll()<br />
		&nbsp;&nbsp;&nbsp; 5. 删除监听器：CacheBuilder.removalListener(RemovalListener)</p>
</div>
<p style="background-color: rgb(230, 230, 250); height: 25px; width: 100%; padding-top: 9px; font-family: arial,helvetica,sans-serif; font-size: 14px; color: rgb(0, 0, 0);"><span style="font-size:14px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp; refresh机制 </strong></span></p>
<div style="border-left: 2px solid rgb(204, 204, 204); padding-left: 6px; margin-left: 6px; margin-bottom: 10px;">
	<p>&nbsp;&nbsp;&nbsp; 1. LoadingCache.refresh(K)&nbsp; 在生成新的value的时候，旧的value依然会被使用。<br />
		&nbsp;&nbsp;&nbsp; 2. CacheLoader.reload(K, V) 生成新的value过程中允许使用旧的value<br />
		&nbsp;&nbsp;&nbsp; 3. CacheBuilder.refreshAfterWrite(long, TimeUnit) 自动刷新cache</p>
</div>
<p style="background-color: rgb(230, 230, 250); height: 25px; width: 100%; padding-top: 9px; font-family: arial,helvetica,sans-serif; font-size: 14px; color: rgb(0, 0, 0);"><span style="font-size:14px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp; 未来要实现的功能 </strong></span></p>
<div style="border-left: 2px solid rgb(204, 204, 204); padding-left: 6px; margin-left: 6px; margin-bottom: 10px;">
	<p>&nbsp;&nbsp;&nbsp; 1. 更多统计信息，通过Cache.stats()来获取统计类CacheStats，例如缓存命中率，缓存获取实践统计等<br />
		&nbsp;&nbsp;&nbsp; 2. asMap，把缓存动作一个ConcurrentMap</p>
</div>
<p><br />
	参考资料 ：<a href="http://code.google.com/p/guava-libraries/wiki/CachesExplained#Inserted_Directly" target="_blank">http://code.google.com/p/guava-libraries/wiki/CachesExplained#Inserted_Directly &nbsp;</a></p>
